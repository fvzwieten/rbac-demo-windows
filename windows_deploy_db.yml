---
# This playbook deploys the db

- name: Deploy db
#  hosts: localhost    
  hosts: role_dbserver
  vars_files:
    winrm_vars.yml
  tasks:
#  - name: create DB
#    mysql_db:
#      login_host: 168.63.109.207
#      name: "testdb"
#      login_user: "dbuser"
#      login_password: "password"
  
  - name: copy mysql prep to host
    win_template:
      src: prepmysql.sql.j2
      dest: C:\Windows\Temp\prepmysql.sql

#  - name: copy prepsql batchfile
#    win_copy:
#      src: prepsql.bat
#      dest: C:\Windows\Temp\prepsql.bat
      
  - name: prep mysql on host for remote access
#    win_command: 'C:\Windows\Temp\prepsql.bat'
    win_shell: 'mysql -u root < C:\Windows\Temp\prepmysql.sql'
    args:
      executable: cmd
